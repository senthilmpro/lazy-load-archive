{"version":3,"sources":["intersectionObserver.js","services/http-util.js","components/IdentifierList/IdentifierList.js","ImageRenderer.js","services/archive-helper.js","components/ImageLoader/ImageLoader.js","components/Home/Home.js","App.js","index.js"],"names":["observer","HttpUtil","getImagesData","url","a","axios","get","response","data","getIdentifierData","docs","map","x","identifier","IdentifierList","onChange","loadFirstSite","useState","list","setList","useEffect","then","className","value","listenerCallbacks","WeakMap","handleIntersections","entries","forEach","entry","has","target","cb","isIntersecting","intersectionRatio","unobserve","delete","getIntersectionObserver","undefined","IntersectionObserver","rootMargin","threshold","ImageRenderer","elem","callback","thumb","width","height","onImgError","isLoaded","setIsLoaded","isInView","setIsInView","showImage","setShowImage","imgRef","useRef","current","set","observe","copyImageBBToClipboard","ev","preventDefault","text","dummy","document","createElement","body","appendChild","select","execCommand","removeChild","copyImageToClipboard","toDataURLAxios","setCanvasImage","path","func","img","onload","c","this","naturalWidth","naturalHeight","ctx","drawImage","toBlob","blob","src","console","log","responseType","Blob","URL","createObjectURL","Image","getContext","imgBlob","navigator","clipboard","write","ClipboardItem","e","catch","ref","style","paddingBottom","minHeight","display","href","rel","classnames","onLoad","onError","onClick","icon","faCopy","faSitemap","ArchiveHelper","getArchiveUrl","itemId","parseArchiveData","files","metadata","server","dir","sourceFiles","filter","source","thumbs","format","getIdentifierCreator","creator","ImageLoader","selectedIdentifier","setData","imageFiles","setImageFiles","getData","sourceData","imgArray","imgs","name","ITEM_LIST","Home","selectedList","setSelectedList","App","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.3ebc0ff1.chunk.js","sourcesContent":["import { useEffect } from 'react';\n\nlet listenerCallbacks = new WeakMap();\n\nlet observer;\n\nfunction handleIntersections(entries) {\n  entries.forEach(entry => {\n    if (listenerCallbacks.has(entry.target)) {\n      let cb = listenerCallbacks.get(entry.target);\n\n      if (entry.isIntersecting || entry.intersectionRatio > 0) {\n        observer.unobserve(entry.target);\n        listenerCallbacks.delete(entry.target);\n        cb();\n      }\n    }\n  });\n}\n\nfunction getIntersectionObserver() {\n  if (observer === undefined) {\n    observer = new IntersectionObserver(handleIntersections, {\n      rootMargin: '100px',\n      threshold: '0.15'\n    });\n  }\n  return observer;\n}\n\nexport function useIntersection(elem, callback) {\n  useEffect(() => {\n    let target = elem.current;\n    let observer = getIntersectionObserver();\n    listenerCallbacks.set(target, callback);\n    observer.observe(target);\n\n    return () => {\n      listenerCallbacks.delete(target);\n      observer.unobserve(target);\n    };\n  }, []);\n}\n","import axios from 'axios';\n\nconst parseImages = (data) => {\n\n}   \n\nconst getImagesData = async (url) => {\n    const response = await axios.get(url);\n    const data = await response.data;\n    return data;\n}\n\nconst getIdentifierData = async () => {\n    let url = `https://archive.org/advancedsearch.php?q=creator%3Apix0x&fl%5B%5D=identifier&sort%5B%5D=publicdate+desc&sort%5B%5D=&sort%5B%5D=&rows=50&page=1&output=json&save=yes`;\n    const response = await axios.get(url);\n    const data = await response.data;\n    return data.response.docs.map(x => x.identifier);\n}\n\n\n\nconst HttpUtil = {\n    getImagesData,\n    getIdentifierData\n}\n\nexport default HttpUtil;","import React, { useEffect, useState } from 'react';\nimport HttpUtil from '../../services/http-util';\n\nconst IdentifierList = ({onChange, loadFirstSite}) => {\n\n    const [data, setData] = useState(null);\n    const [list, setList] = useState(null);\n\n\n\n    useEffect(() => {\n        HttpUtil.getIdentifierData().then(data => {\n            setList(data);\n            loadFirstSite(data);\n        })\n    }, [])\n\n    return (\n        <select onChange={onChange} className=\"custom-select custom-select-lg\">\n            {list && list.map(x => <option value={x}>{x}</option>)}\n        </select>\n    )\n}\n\nexport default IdentifierList;","import React, { useState, useRef } from 'react';\nimport classnames from 'classnames';\nimport { useIntersection } from './intersectionObserver';\nimport './imageRenderer.scss';\nimport axios from 'axios';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome'\nimport { faCopy, faSitemap } from '@fortawesome/free-solid-svg-icons'\n\n\n\nconst ImageRenderer = ({ url, thumb, width, height, onImgError }) => {\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [isInView, setIsInView] = useState(false);\n  const [showImage, setShowImage] = useState(\"inherit\");\n  const imgRef = useRef();\n  useIntersection(imgRef, () => {\n    setIsInView(true);\n  });\n\n  const onError = () => {\n    setShowImage(\"none\");\n  }\n\n  const handleOnLoad = () => {\n    setIsLoaded(true);\n  };\n\n  const copyImageBBToClipboard = async (ev, url) => {\n    ev.preventDefault();\n    let text = `[IMG]${url}[/IMG]`\n    var dummy = document.createElement(\"textarea\");\n    document.body.appendChild(dummy);\n    dummy.value = text;\n    dummy.select();\n    document.execCommand(\"copy\");\n    document.body.removeChild(dummy);\n  }\n\n  const copyImageToClipboard = async (ev, url) => {\n    ev.preventDefault();\n\n    async function toDataURLAxios(url) {\n      return axios.get(url, {\n          responseType: 'arraybuffer'\n        })\n        .then(response => response.data).then(data => {\n            let blob = new Blob([data]);\n            return blob\n        }).then(blob => {\n          return URL.createObjectURL(blob);\n      });\n  }\n\n    const img = new Image\n    const c = document.createElement('canvas')\n    const ctx = c.getContext('2d')\n\n\n    function setCanvasImage(path, func) {\n      img.onload = function () {\n        c.width = this.naturalWidth\n        c.height = this.naturalHeight\n        ctx.drawImage(this, 0, 0)\n        c.toBlob(blob => {\n          func(blob)\n        }, 'image/png')\n      }\n      img.src = path\n\n      console.log(img);\n    }\n\n    await toDataURLAxios(url).then(path => {\n      setCanvasImage(path, (imgBlob) => {\n        console.log('doing it!')\n        navigator.clipboard.write(\n          [\n            new ClipboardItem({ 'image/png': imgBlob })\n          ]\n        )\n          .then(e => { console.log('Image copied to clipboard') })\n          .catch(e => { console.log(e) })\n      })\n    });\n  }\n\n  return (\n    <div\n      className=\"image-container\"\n      ref={imgRef}\n      style={{\n        paddingBottom: `10px`,\n        minHeight: '240px',\n        display: showImage\n      }}\n    >\n      {isInView && (\n        <>\n          <a href={url} target={\"_blank\"} rel=\"noopener noreferrer\" >\n            <img\n              className={classnames('image', 'thumb', {\n                ['isLoaded']: !!isLoaded\n              })}\n              src={thumb}\n            />\n            <img\n              className={classnames('image', {\n                ['isLoaded']: !!isLoaded\n              })}\n              src={thumb}\n              onLoad={handleOnLoad}\n              onError={onError}\n            />\n            </a>\n            <div className=\"button-list\">\n              <button onClick={(ev) => copyImageToClipboard(ev,url)} className={\"btn-standard\"} ><FontAwesomeIcon icon={faCopy} /></button>\n              <button onClick={(ev) => copyImageBBToClipboard(ev,url)} className={\"btn-standard\"} ><FontAwesomeIcon icon={faSitemap} /></button>\n            </div>\n            \n        </>\n      )}\n    </div>\n  );\n};\n\nexport default ImageRenderer;\n","\nconst getArchiveUrl = (itemId) => {\n    return `https://archive.org/metadata/${itemId}`\n}\n\nconst getIdentifierCreator = (creator) => {\n    return `https://archive.org/advancedsearch.php?q=creator%3Apix0x&fl%5B%5D=identifier&sort%5B%5D=publicdate+desc&sort%5B%5D=&sort%5B%5D=&rows=50&page=1&output=json&callback=callback&save=yes`;\n}\n\nconst parseArchiveData = (data) => {\n    if(!data) return null;\n    const {files, metadata, server, dir} = data;\n    const sourceFiles = files.filter(x => x.source == \"original\");\n    const thumbs = files.map(x => x.source === \"derivative\" && x.format === \"Thumbnail\");\n    return {\n        metadata,\n        sourceFiles,\n        thumbs,\n        server, \n        dir\n    }\n}\n\nconst ArchiveHelper = {\n    getArchiveUrl,\n    parseArchiveData,\n    getIdentifierCreator\n}\n\nexport default ArchiveHelper;","import React, { useEffect, useState } from 'react';\nimport ImageRenderer from '../../ImageRenderer';\nimport ArchiveHelper from \"../../services/archive-helper\";\nimport HttpUtil from \"../../services/http-util\";\n\n\n\n\n\n\nconst ImageLoader = ({selectedIdentifier}) => {\n    const [data, setData] = useState(null);\n    const [images, setImages] = useState(null);\n    const [imageFiles, setImageFiles] = useState(null);\n\n    const getData = async () => {\n        const itemId = selectedIdentifier;\n        const url  = ArchiveHelper.getArchiveUrl(itemId);\n        const data = await HttpUtil.getImagesData(url);\n        const sourceData = ArchiveHelper.parseArchiveData(data);\n        \n        const {sourceFiles, dir, server} = sourceData;\n        let imgArray = sourceFiles.filter(x => x.format == \"JPEG\");\n        let imgs = imgArray.map(x => ({\n            img: `https://i0.wp.com/${server}/${dir}/${x.name}`,\n            thumb: `https://i0.wp.com/${server}/${dir}/${x.name}?w=320`\n        }));\n        console.log(imgs);\n        setImageFiles(imgs);\n        //console.log(images);\n        console.log(sourceFiles);\n\n        setData(data);\n    }\n\n    useEffect(() => {\n        getData();\n    }, [selectedIdentifier]);\n\n    return imageFiles && imageFiles.map(x => \n        <ImageRenderer\n        key={x.img}\n        url={x.img}\n        thumb={x.thumb}\n        width={640}\n        height={480}\n      />\n    )\n        \n    ;\n}\n\nexport default ImageLoader;","import React, { useEffect, useState } from 'react';\nimport IdentifierList from '../IdentifierList/IdentifierList';\nimport ImageLoader from '../ImageLoader/ImageLoader';\n\nconst ITEM_LIST = [\n    'pix0x-57d723e9',\n    'pix0x-257ae802',\n    '2021-8-16-pix0x-d84c36573d37'\n]\nconst Home = () => {\n\n  const [selectedList, setSelectedList ] = useState(ITEM_LIST[0]);\n\n  const onSelectedListChange = (ev) => {\n    console.log(ev.target.value)\n    setSelectedList(ev.target.value);\n  }\n\n  const loadFirstSite = (data) => {\n    setSelectedList(data[0]);\n  }\n\n  return (\n    <section>\n      <IdentifierList onChange={onSelectedListChange} loadFirstSite={loadFirstSite} />\n      <div className=\"ImageGallery\">\n        <ImageLoader selectedIdentifier={selectedList} />\n      </div>\n    </section>\n  );\n};\n\n\nexport default Home;","import React from 'react';\nimport Home from './components/Home/Home';\nimport './App.scss'\nimport imageData from './imageData';\nimport ImageRenderer from './ImageRenderer';\n\nimport './style.css';\n\nexport default function App() {\n  return (\n    <div>\n      <h1>Lazy Load Images</h1>\n      <Home />\n    </div>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}